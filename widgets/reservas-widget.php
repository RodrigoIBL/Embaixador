<?php if (!defined('ABSPATH')) { exit; } use Elementor\Widget_Base; use Elementor\Controls_Manager; class Reservas_Widget extends Widget_Base { public function get_name() { return 'reservas_calendario'; } public function get_title() { return __('Calendário Reservas', 'reservas'); } public function get_icon() { return 'eicon-calendar'; } public function get_categories() { return ['general']; } // Definir controles se quiser no painel Elementor (opcional) 
public function _register_controls() { $this->start_controls_section( 'content_section', [ 'label' => __('Conteúdo', 'reservas'), 'tab' => Controls_Manager::TAB_CONTENT, ] ); $this->add_control( 'titulo', [ 'label' => __('Título', 'reservas'), 'type' => Controls_Manager::TEXT, 'default' => __('Reservas', 'reservas'), ] ); $this->end_controls_section(); } // Renderizar o widget 
public function render() { $settings = $this->get_settings_for_display(); 
// Pega os dados da API 
$api_url = 'https://app.hostkit.pt/api/getReservations?APIKEY=5aQElqgU34RIgKDsKxIfuqzjVFR7eH8XxUgZ1StjpcD3rTrJRI'; $response = wp_remote_get($api_url); if (is_wp_error($response)) { echo '<p>Erro ao aceder à API: ' . esc_html($response->get_error_message()) . '</p>'; return; } $status_code = wp_remote_retrieve_response_code($response); if ($status_code !== 200) { echo '<p>Status HTTP inesperado: ' . esc_html($status_code) . '</p>'; return; } $body = wp_remote_retrieve_body($response); $body_clean = iconv('UTF-8', 'UTF-8//IGNORE', $body); $dados = json_decode($body_clean, true); if (json_last_error() !== JSON_ERROR_NONE) { echo '<p>Erro ao decodificar JSON: ' . esc_html(json_last_error_msg()) . '</p>'; return; } if (empty($dados)) { echo '<p>Nenhuma reserva encontrada.</p>'; return; } 
// Ordenar as reservas por in_date (check-in) 
usort($dados, function($a, $b) { $inA = isset($a['in_date']) ? intval($a['in_date']) : 0; $inB = isset($b['in_date']) ? intval($b['in_date']) : 0; return $inA <=> $inB; }); echo '<h2>' . esc_html($settings['titulo']) . '</h2>'; echo '<table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">'; echo '<thead>'; echo '<tr>'; echo '<th style="border: 1px solid #ddd; padding: 8px;">Nome</th>'; echo '<th style="border: 1px solid #ddd; padding: 8px;">Check-In</th>'; echo '<th style="border: 1px solid #ddd; padding: 8px;">Check-Out</th>'; echo '<th style="border: 1px solid #ddd; padding: 8px;">Provider</th>'; echo '</tr>'; echo '</thead>'; echo '<tbody>'; foreach ($dados as $reserva) { $nome = trim(($reserva['firstname'] ?? '') . ' ' . ($reserva['lastname'] ?? '')); $checkinUnix = !empty($reserva['in_date']) ? intval($reserva['in_date']) : 0; $checkoutUnix = !empty($reserva['out_date']) ? intval($reserva['out_date']) : 0; $checkin = $checkinUnix ? date('Y-m-d', $checkinUnix) : ''; $checkout = $checkoutUnix ? date('Y-m-d', $checkoutUnix) : ''; $provider = $reserva['provider'] ?? ''; echo '<tr>'; echo '<td style="border: 1px solid #ddd; padding: 8px;">' . esc_html($nome) . '</td>'; echo '<td style="border: 1px solid #ddd; padding: 8px;">' . esc_html($checkin) . '</td>'; echo '<td style="border: 1px solid #ddd; padding: 8px;">' . esc_html($checkout) . '</td>'; echo '<td style="border: 1px solid #ddd; padding: 8px;">' . esc_html($provider) . '</td>'; echo '</tr>'; } echo '</tbody>'; echo '</table>'; } }